<!DOCTYPE html>
<html lang="zh-CN" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LongTextAgent åˆ›ä½œå°</title>
    
    <!-- Tailwind CSS & DaisyUI -->
    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.7.2/dist/full.min.css" rel="stylesheet" type="text/css" />
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Vue 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    
    <!-- Marked.js for Markdown rendering -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 100%);
            min-height: 100vh;
            color: #e2e8f0;
        }

        .glass-panel {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }

        .gradient-text {
            background: linear-gradient(to right, #3b82f6, #8b5cf6, #ec4899);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .markdown-body {
            line-height: 1.8;
            font-size: 1.05rem;
        }
        .markdown-body h1 { font-size: 1.8rem; font-weight: bold; margin-top: 1.5rem; margin-bottom: 1rem; color: #f8fafc; }
        .markdown-body h2 { font-size: 1.5rem; font-weight: bold; margin-top: 1.5rem; margin-bottom: 1rem; color: #f1f5f9; border-bottom: 1px solid #334155; padding-bottom: 0.5rem; }
        .markdown-body h3 { font-size: 1.25rem; font-weight: bold; margin-top: 1.5rem; margin-bottom: 0.5rem; color: #e2e8f0; }
        .markdown-body p { margin-bottom: 1rem; color: #cbd5e1; }
        .markdown-body ul, .markdown-body ol { margin-left: 1.5rem; margin-bottom: 1rem; color: #cbd5e1; list-style-type: disc; }
        .markdown-body blockquote { border-left: 4px solid #8b5cf6; padding-left: 1rem; font-style: italic; color: #94a3b8; margin-bottom: 1rem; background: rgba(139, 92, 246, 0.1); padding: 0.5rem 1rem; border-radius: 0 0.5rem 0.5rem 0;}
    </style>
</head>
<body class="p-4 md:p-8">

<div id="app" class="max-w-7xl mx-auto">
    <!-- Header -->
    <header class="text-center mb-10">
        <h1 class="text-4xl md:text-6xl font-extrabold mb-4 tracking-tight">
            <span class="gradient-text">LongText Agent</span> Studio
        </h1>
        <p class="text-slate-400 text-lg">åŸºäºåŒæ¨¡å‹æŠ¤èˆª (Kimi + DeepSeek) çš„é«˜è´¨é‡é•¿æ–‡æœ¬/çŸ­å‰§ç”Ÿæˆå¹³å°</p>
    </header>

    <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
        
        <!-- Left Panel: Configuration -->
        <div class="lg:col-span-5">
            <div class="glass-panel rounded-2xl p-6 lg:p-8 sticky top-8">
                <h2 class="text-2xl font-bold mb-6 text-white flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>
                    åˆ›ä½œæ§åˆ¶å°
                </h2>

                <div class="form-control mb-4">
                    <label class="label"><span class="label-text text-slate-300">ä½œå“æ ‡é¢˜</span></label>
                    <input type="text" v-model="form.title" placeholder="ä¾‹å¦‚ï¼šéœ¸æ€»å¤ä»‡è®°" class="input input-bordered w-full bg-slate-800/50 border-slate-600 focus:border-blue-500 text-white" />
                </div>

                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div class="form-control">
                        <label class="label"><span class="label-text text-slate-300">åˆ›ä½œæ¨¡å¼</span></label>
                        <select v-model="form.mode" class="select select-bordered w-full bg-slate-800/50 border-slate-600 focus:border-blue-500 text-white">
                            <option value="drama">ğŸ¬ çŸ­å‰§/æ¼«å‰§çˆ½æ–‡ (æ¨è)</option>
                            <option value="novel">ğŸ“š ä¼ ç»Ÿå°è¯´</option>
                            <option value="report">ğŸ“Š ç ”ç©¶æŠ¥å‘Š</option>
                            <option value="article">ğŸ“ çˆ†æ¬¾æ–‡ç« </option>
                        </select>
                    </div>
                    
                    <div class="form-control">
                        <label class="label"><span class="label-text text-slate-300">ç›®æ ‡å­—æ•°</span></label>
                        <input type="number" v-model="form.target_words" min="500" max="20000" step="500" class="input input-bordered w-full bg-slate-800/50 border-slate-600 focus:border-blue-500 text-white" />
                    </div>
                </div>

                <div class="form-control mb-6">
                    <label class="label">
                        <span class="label-text text-slate-300">æ ¸å¿ƒå¤§çº²ä¸è¦æ±‚</span>
                        <span class="label-text-alt text-slate-400">è¶Šè¯¦ç»†æ•ˆæœè¶Šå¥½</span>
                    </label>
                    <textarea v-model="form.outline" class="textarea textarea-bordered h-48 bg-slate-800/50 border-slate-600 focus:border-blue-500 text-white leading-relaxed" placeholder="è¯·è¾“å…¥æ•…äº‹å¤§çº²ã€è§’è‰²è®¾å®šã€çˆ½ç‚¹è®¾è®¡ã€‚å¦‚æœé€‰æ‹©äº†çŸ­å‰§æ¨¡å¼ï¼Œè¯·åŠ¡å¿…å¼ºè°ƒã€é»„é‡‘ä¸‰ç§’ã€‘å’Œã€æ‰“è„¸åå‡»ã€‘çš„æƒ…èŠ‚..."></textarea>
                </div>

                <button 
                    @click="startGeneration" 
                    :disabled="isGenerating"
                    class="btn btn-primary w-full border-0 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-500 hover:to-purple-500 text-white font-bold text-lg shadow-lg shadow-blue-900/50 transition-all duration-300 hover:scale-105"
                >
                    <span v-if="!isGenerating">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 inline-block mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" /></svg>
                        å¼€å§‹ AI åˆ›ä½œ
                    </span>
                    <span v-else class="flex items-center justify-center">
                        <span class="loading loading-spinner loading-md mr-2"></span>
                        {{ generationStatusText }}...
                    </span>
                </button>
            </div>
        </div>

        <!-- Right Panel: Result Preview -->
        <div class="lg:col-span-7">
            <div class="glass-panel rounded-2xl h-full min-h-[600px] flex flex-col overflow-hidden relative">
                
                <!-- Status Overlay (When generating) -->
                <div v-if="isGenerating" class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm z-10 flex flex-col items-center justify-center p-8 text-center transition-all">
                    <div class="w-24 h-24 mb-6 relative">
                        <div class="absolute inset-0 rounded-full border-t-4 border-blue-500 animate-spin"></div>
                        <div class="absolute inset-2 rounded-full border-r-4 border-purple-500 animate-spin" style="animation-direction: reverse; animation-duration: 1.5s;"></div>
                        <div class="absolute inset-4 rounded-full border-b-4 border-pink-500 animate-spin" style="animation-duration: 2s;"></div>
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z" /></svg>
                    </div>
                    <h3 class="text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-purple-400 mb-2">{{ generationStatusText }}</h3>
                    <p class="text-slate-300 max-w-md">
                        é•¿æ–‡æœ¬ç”Ÿæˆæ­£åœ¨åå°è¿›è¡Œä¸­ã€‚å¦‚æœæ˜¯çŸ­å‰§æ¨¡å¼ï¼Œè£åˆ¤æ€»ç›‘æ­£åœ¨å¯¹æ¯ä¸€å¹•è¿›è¡Œä¸¥è‹›çš„æ‰“åˆ†ä¸é‡å†™è¿­ä»£ï¼Œè¿™å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿæ—¶é—´ï¼Œè¯·è€å¿ƒç­‰å¾…ã€‚
                    </p>
                    <div class="mt-8 w-full max-w-sm">
                        <progress class="progress progress-primary w-full" :value="generateProgress" max="100"></progress>
                    </div>
                    <div class="mt-4 text-sm text-slate-400 font-mono flex items-center gap-2">
                        <span class="relative flex h-3 w-3">
                          <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-blue-400 opacity-75"></span>
                          <span class="relative inline-flex rounded-full h-3 w-3 bg-blue-500"></span>
                        </span>
                        Kimi (æ‰§ç¬”) & DeepSeek (è£åˆ¤) æ­£åœ¨ç–¯ç‹‚è¿è½¬...
                    </div>
                </div>

                <!-- Header -->
                <div class="border-b border-slate-700/50 bg-slate-800/80 p-4 flex justify-between items-center z-0">
                    <h2 class="text-lg font-bold text-white flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-purple-400" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z" clip-rule="evenodd" /></svg>
                        ç”Ÿæˆç»“æœé¢„è§ˆ
                    </h2>
                    <div class="badge badge-primary badge-outline" v-if="resultContent">å·²å®Œæˆ {{ wordCount }} å­—</div>
                </div>

                <!-- Content Area -->
                <div class="flex-1 overflow-y-auto p-6 md:p-8 bg-slate-900/50">
                    <div v-if="!resultContent && !isGenerating" class="h-full flex flex-col items-center justify-center text-slate-500">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-20 w-20 mb-4 opacity-50" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 002-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" /></svg>
                        <p class="text-lg">é…ç½®å¤§çº²å¹¶ç‚¹å‡»å·¦ä¾§æŒ‰é’®å¼€å§‹ç”Ÿæˆ</p>
                    </div>

                    <!-- Rendered Markdown -->
                    <div v-else-if="resultContent" id="markdown-container" class="markdown-body" v-html="renderedContent"></div>
                </div>
                
                <!-- Action Bar -->
                <div v-if="resultContent" class="border-t border-slate-700/50 bg-slate-800/80 p-4 flex justify-end gap-3 z-0">
                    <button @click="copyContent" class="btn btn-sm btn-outline text-slate-300 hover:text-white">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3" /></svg>
                        å¤åˆ¶å…¨æ–‡
                    </button>
                    <button @click="downloadContent" class="btn btn-sm btn-primary">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" /></svg>
                        ä¸‹è½½ MD æ–‡ä»¶
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const { createApp, ref, computed, onMounted } = Vue;

    createApp({
        setup() {
            const form = ref({
                title: 'éœ¸é“æ€»è£çš„å¥‘çº¦èµ˜å©¿',
                mode: 'drama',
                target_words: 3000,
                outline: `ç¬¬ä¸€å¹•ï¼šå®¶æ—æ™šå®´ä¸Šçš„æƒŠå˜
- æ¥šå¤©ï¼ˆç”·ä¸»ï¼‰ä½œä¸ºæ—å®¶èµ˜å©¿ï¼Œåœ¨å²³çˆ¶å¯¿å®´ä¸Šè¢«æ—å®¶å°èˆ…å­å½“ä¼—æ³¼æ»¡èº«çº¢é…’ï¼Œå¹¶ç”©å‡ºä¼ªé€ çš„å‡ºè½¨ç…§ç‰‡é€¼ä»–å‡€èº«å‡ºæˆ·ã€‚
- å¦»å­æ—å©‰å„¿å†·çœ¼æ—è§‚ï¼Œä¸å‘ä¸€è¯­ï¼Œé»˜è®¸äº†å®¶æ—çš„æ¬ºè¾±ã€‚
- æ¥šå¤©å†·ç¬‘ï¼Œæ¯«ä¸çŠ¹è±«ç­¾ä¸‹ç¦»å©šåè®®ã€‚ä¸‹ä¸€ç§’ï¼Œé¦–å¯Œçš„ç›´å‡æœºé™è½åœ¨å®´ä¼šå…å¤–ï¼Œå…¨çƒé¦–å¯Œç®¡å®¶æ¨é—¨è€Œå…¥ï¼Œå•è†è·ªåœ°ï¼šâ€œå°‘çˆ·ï¼Œä¸‰å¹´è€ƒæ ¸æœŸå·²æ»¡ï¼Œåƒäº¿å¸å›½ç­‰æ‚¨ç»§æ‰¿ã€‚â€

ç¬¬äºŒå¹•ï¼šæ‰“è„¸ç»¿èŒ¶å‰å¦»
- æ—å®¶å…¬å¸èµ„é‡‘é“¾æ–­è£‚ï¼Œæ—å©‰å„¿å»é¦–å¯Œè´¢å›¢æ±‚èŒæ±‚æŠ•èµ„ã€‚
- åœ¨é¢è¯•ä¼šè®®å®¤ï¼Œæ—å©‰å„¿å‘èº¬å±ˆè†ï¼ŒæŠ¬å¤´å´å‘ç°ååœ¨æ€»è£æ¤…ä¸Šè½¬è¿‡æ¥çš„äººï¼Œæ­£æ˜¯å¥¹åˆšæ‰«åœ°å‡ºé—¨çš„â€œåºŸç‰©èµ˜å©¿â€æ¥šå¤©ã€‚
- æ¥šå¤©å†·å†·å°†å¥¹çš„è®¡åˆ’ä¹¦æ‰”è¿›åƒåœ¾æ¡¶...`
            });

            const isGenerating = ref(false);
            const generationStatusText = ref('AI æ„æ€ä¸­');
            const generateProgress = ref(0);
            const resultContent = ref('');
            const wordCount = ref(0);
            
            let pollInterval = null;

            const renderedContent = computed(() => {
                if (!resultContent.value) return '';
                return marked.parse(resultContent.value);
            });

            const startGeneration = async () => {
                if (!form.value.outline || !form.value.title) {
                    alert('è¯·å¡«å†™å®Œæ•´çš„æ ‡é¢˜å’Œå¤§çº²ï¼');
                    return;
                }

                isGenerating.value = true;
                resultContent.value = '';
                generateProgress.value = 10;
                generationStatusText.value = 'æäº¤ç”Ÿæˆè§„åˆ’';

                try {
                    const response = await fetch('/api/generate', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            title: form.value.title,
                            outline: form.value.outline,
                            target_words: parseInt(form.value.target_words),
                            mode: form.value.mode,
                            enable_check: true
                        })
                    });

                    const data = await response.json();
                    if (data.task_id) {
                        generateProgress.value = 30;
                        pollStatus(data.task_id);
                    } else {
                        throw new Error(data.detail || 'è¯·æ±‚å¤±è´¥');
                    }
                } catch (error) {
                    alert('ç”Ÿæˆå‘èµ·äº†è¯·æ±‚ï¼Œä½†é­é‡é”™è¯¯: ' + error.message);
                    isGenerating.value = false;
                }
            };

            const pollStatus = (taskId) => {
                let ticks = 0;
                if (pollInterval) clearInterval(pollInterval);
                
                pollInterval = setInterval(async () => {
                    ticks++;
                    // Fake progress animation
                    if (generateProgress.value < 85) {
                        generateProgress.value += 1;
                    }

                    // Rotating fun texts
                    const statusTexts = [
                        "Kimi æ­£åœ¨å¥‹ç¬”ç–¾ä¹¦...",
                        "DeepSeek è£åˆ¤æ­£åœ¨ä¸¥å‰æ‰“åˆ†...",
                        "å‘ç°å‰§æƒ…å¹³æ·¡ï¼Œå¼ºåˆ¶æ‰“å›é‡å†™...",
                        "ä¿®æ­£å‰§æƒ…èŠ‚å¥ï¼Œå¼ºåŒ–ç”»é¢æ„Ÿ...",
                        "æ·»åŠ é»„é‡‘ä¸‰ç§’çˆ†ç‚¹...",
                        "æ•´åˆä¸Šä¸‹æ–‡ï¼Œå¤„ç†å‰§æƒ…è½¬æŠ˜..."
                    ];
                    if (ticks % 3 === 0) {
                        generationStatusText.value = statusTexts[Math.floor(Math.random() * statusTexts.length)];
                    }

                    try {
                        const response = await fetch(`/api/task/${taskId}`);
                        const data = await response.json();

                        if (data.status === 'completed') {
                            clearInterval(pollInterval);
                            finishGeneration(data.content, data.word_count);
                        } else if (data.status === 'failed') {
                            clearInterval(pollInterval);
                            alert('ç”Ÿæˆå¤±è´¥: ' + data.error);
                            isGenerating.value = false;
                        }
                    } catch (error) {
                        console.error('Polling error:', error);
                    }
                }, 3000);
            };

            const finishGeneration = (content, count) => {
                generateProgress.value = 100;
                generationStatusText.value = 'å³å°†å®Œæˆ';
                
                setTimeout(() => {
                    resultContent.value = content;
                    wordCount.value = count;
                    isGenerating.value = false;
                }, 800);
            };

            const copyContent = () => {
                navigator.clipboard.writeText(resultContent.value).then(() => {
                    alert('å†…å®¹å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
                });
            };

            const downloadContent = () => {
                const blob = new Blob([resultContent.value], { type: 'text/markdown' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${form.value.title}.md`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
            };

            return {
                form,
                isGenerating,
                generationStatusText,
                generateProgress,
                resultContent,
                renderedContent,
                wordCount,
                startGeneration,
                copyContent,
                downloadContent
            };
        }
    }).mount('#app');
</script>
</body>
</html>
