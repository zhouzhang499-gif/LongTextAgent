# Human-In-The-Loop (HITL) äº¤äº’ç”Ÿæˆç‰¹æ€§æ¶æ„è®¾è®¡

**æ—¥æœŸ**: 2026-02-25
**ä¸»é¢˜**: çªç ´é•¿æ–‡æœ¬ Agent ä¸€é”¤å­ä¹°å–é™åˆ¶ï¼Œå¼•å…¥äººæœºå…±åˆ› (Human-In-The-Loop) æ–­ç‚¹ã€‚

## ğŸ¨ 1. ä¸šåŠ¡æ„¿æ™¯

ç”¨æˆ·åœ¨è·‘é•¿ç¯‡å¤§è®ºï¼ˆæ¯”å¦‚å‡ ä¸‡å­—å°è¯´ï¼‰æ—¶ï¼Œå¤§æ¨¡å‹ä¸€æ—¦åœ¨ç¬¬2ç« å†™åï¼Œåç»­å…¨éƒ¨å´©æºƒã€‚æˆ‘ä»¬éœ€è¦å¼•å…¥â€œå•ç« æ‚¬åœæœºåˆ¶â€ï¼šå†™å®Œä¸€ç«  -> ç»ˆç«¯æ‚¬æŒ‚ -> å‰ç«¯å¼¹å‡ºè®©ç”¨æˆ·æ¶¦è‰²ä¿®æ”¹ -> ç”¨æˆ·æ”¾è¡Œ -> ç³»ç»Ÿè½½å…¥ç”¨æˆ·çš„ä¿®æ”¹å¹¶ç”Ÿæˆä¸‹ä¸€ç« ã€‚

## âš™ï¸ 2. æŠ€æœ¯æ¶æ„é€‰å‹ (çŠ¶æ€æœºå›è°ƒæ³¨å…¥æ³•)

**åŸç†ï¼šä¿æŒ Pipeline æ— çŠ¶æ€ä¸åç«¯æœ‰çŠ¶æ€è§£è€¦**

ç”±äºå½“å‰çš„ `pipeline.run` æ˜¯çº¯ç²¹çš„ Python åŒæ­¥é•¿é˜»å¡æ‰§è¡Œé€»è¾‘ï¼Œæˆ‘ä»¬ç›´æ¥åœ¨å…¶ä¸­å¼€ä¸ªé’©å­ï¼ˆHookï¼‰ï¼Œä¸æ”¹å˜åŸæœ‰å¤æ‚çš„æ ‘çº§æœç´¢ç»“æ„ï¼š

### 2.1 Backend / Pipeline å±‚

1. **`novel_pipeline.py` ä¿®æ”¹**ï¼š
   åœ¨ `pipeline.run()` çš„å¾ªç¯ä¸­ï¼Œå½“ä¸€ç« ç”Ÿæˆå®Œæ¯•ï¼ˆ`checker`æ ¡éªŒé€šè¿‡åã€`summary_store.add_section`å‰ï¼‰ï¼Œè§¦å‘ä¸€ä¸ªåŒæ­¥å›è°ƒï¼š
   `chapter_content = on_section_complete(chapter_content)`
2. **`api_server.py` é©»ç•™**ï¼š
   - å¢åŠ çº¿ç¨‹çº§åˆ«çš„ `threading.Event()`ã€‚
   - `on_section_complete` å›è°ƒè¢«è§¦å‘æ—¶ï¼Œä¿®æ”¹è¯¥è¯·æ±‚åœ¨ `tasks_store` ä¸­çš„ `status='paused'` å’Œ `paused_content`ï¼Œç„¶åè°ƒç”¨ `event.wait()` å¼ºè¡ŒæŠŠå½“å‰åå°ç”Ÿæˆçº¿ç¨‹é”æ­»é˜»å¡ã€‚
3. **`api_server.py` æ–°å¢ Endpoint (`/continue`)**ï¼š
   - æä¾› `POST /api/task/{id}/continue`ï¼Œæ¥æ”¶ `{ modified_content: string }`ã€‚
   - å½“æ”¶åˆ°ç”¨æˆ·æäº¤çš„ä¿®æ”¹åï¼Œå°† `modified_content` è½½å…¥å†…å­˜ï¼Œå¹¶æ‰§è¡Œ `event.set()`ã€‚
   - è¢«é”æ­»çš„çº¿ç¨‹è‹é†’ï¼Œå›è°ƒè¿”å›ä¿®æ”¹åçš„æ–‡æœ¬ï¼Œç³»ç»Ÿä½¿ç”¨è¯¥æ–‡æœ¬è¿›è¡Œå½’æ¡£å’Œä¸‹ä¸€ç« æ¨è¿›ã€‚

### 2.2 Frontend å±‚ (`index.html`)

1. **æ§åˆ¶é¢æ¿æ–°å¢**ï¼šå¢åŠ ä¸€ä¸ª â€œäººæœºå…±åˆ›æ–­ç‚¹å®¡æ ¸â€ å¼€å…³ `interactive: true/false`ã€‚
2. **çŠ¶æ€æœºç›‘å¬æ˜ å°„**ï¼šç”±äºåŸå…ˆçš„è½®è¯¢æ¥å£ `/api/task/{id}` ä¹Ÿä¼šå¸¦å› `paused` çŠ¶æ€å’Œ `paused_content`ï¼Œæˆ‘ä»¬åœ¨è½®è¯¢æ¢æµ‹åˆ°è¯¥çŠ¶æ€æ—¶ï¼š
   - å…¨å±å¼¹å‡ºä¸€ä¸ªå·¨å¤§çš„æ²‰æµ¸å¼ Markdown ç¼–è¾‘æµ®å±‚ã€‚
   - å°†è¿™ç« ç”Ÿæˆçš„åŸå§‹æ–‡æœ¬æ”¾è¿›å»ä¾›ç”¨æˆ·é­”æ”¹ã€‚
   - ç”¨æˆ·ç‚¹å‡» [æ³¨å…¥ä¿®æ”¹å¹¶ç»§ç»­ç¼–è¯‘]ï¼Œå‘èµ· `/continue` è¯·æ±‚ã€‚
   - æµ®å±‚æ¶ˆé€€ï¼Œæ¢å¤åˆ° Hacker é•­å°„ç­‰å€™åŠ¨ç”»ã€‚

## ğŸ›¡ï¸ 3. å®‰å…¨æ€§ä¸è¾¹ç•Œé—®é¢˜

- è¿™ä¸ªé˜»å¡æ˜¯å¤šçº¿ç¨‹å®‰å…¨çš„ `threading.Event`ï¼Œæ¯ä¸ª `task_id` ç‹¬å ä¸€ä¸ªäº‹ä»¶ï¼Œä¸ä¼šäº’ä¸²ã€‚
- å°†ä¿æŒæç®€é£æ ¼ï¼Œä¸å¢åŠ ä»»ä½•ä¾èµ–æ ‘è´Ÿæ‹…ã€‚
